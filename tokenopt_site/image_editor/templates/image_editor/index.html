<!DOCTYPE html>
{% load static %}
<html lang="it">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"/>
    <title>Inpainter - Mask Editor</title>
    <link rel="stylesheet" href="{% static 'image_editor/css/style.css' %}"/>
</head>
<body>

<div class="page-wrapper">
    <!-- HEADER -->
    <header class="site-header">
        <div class="header-inner">
            <div class="logo-area">
                <div class="logo-circle">IN</div>
                <div class="logo-text">
                    <span class="logo-title">Inpainter</span>
                    <span class="logo-subtitle">Mask Editor</span>
                </div>
            </div>
            <nav class="main-nav">
                <a href="#" class="nav-link">Home</a>
                <a href="#" class="nav-link">Guida</a>
                <a href="https://github.com/niccobarto/tokenopt_web" class="nav-link">Documentazione</a>
            </nav>
        </div>
    </header>

    <!-- MAIN -->
    <main class="site-main">
        <section class="hero">
            <!-- Testo descrittivo -->
            <div class="hero-text">
                <h1>Modifica le tue immagini di oggetti</h1>
                <p class="hero-lead">
                    Maschera interi oggetti o parti nell'immagine e scrivi cosa desidereresti al suo posto. Ti verranno
                    fornite quante varianti desideri
                </p>

                <div class="hero-steps">
                    <div class="hero-step">
                        <span class="hero-step-number">1</span>
                        <div>
                            <h3>Carica un'immagine</h3>
                            <p>Scegli l'immagine che preferisci dalla tua galleria.</p>
                        </div>
                    </div>
                    <div class="hero-step">
                        <span class="hero-step-number">2</span>
                        <div>
                            <h3>Scegli come cambiare l'oggetto</h3>
                            <p>Disegna una maschera sopra l'oggetto e scrivi con cosa vorresti sostituirla.</p>
                        </div>
                    </div>
                    <div class="hero-step">
                        <span class="hero-step-number">3</span>
                        <div>
                            <h3>Esporta in un click</h3>
                            <p>Scegli la variante che preferisci tra i risultati e scaricala!</p>
                        </div>
                    </div>
                </div>
            </div>
            <form
                    id="generationForm"
                    method="POST"
                    enctype="multipart/form-data"
                    class="hero-container"
                    action="{% url 'start_generation' %}"
            >
                {% csrf_token %}

                <!-- COLONNA SINISTRA: CONTROLLI + GENERA -->
                <div class="controls-column">
                    <div id="controls">
                        <h4>Editing immagine</h4>
                        <div class="row buttons">
                            <button class="low-margin" type="button" id="undo">Undo</button>
                            <button class="low-margin" type="button" id="redo">Redo</button>
                        </div>

                        <div class="row">
                            <span>Strumento: </span>
                            <input id="penTool" type="radio" name="toolRadio" value="pen" checked/>
                            <label for="penTool">Penna</label>
                            <input id="eraserTool" type="radio" name="toolRadio" value="eraser"/>
                            <label for="eraserTool">Gomma</label>
                        </div>

                        <div class="row">
                            <span>Spessore: </span>
                            <input
                                    type="range"
                                    min="1"
                                    max="50"
                                    value="25"
                                    class="size"
                                    id="sizeRange"
                                    aria-label="Size"
                            />
                        </div>
                        <div class="row">
                            <button type="button" id="clear">Pulisci</button>
                        </div>

                        <div class="row distance space-between">
                            <div>
                                <label class="label" for="rembgModel">Modello rimozione sfondo:</label>
                                <div class="row space-between">
                                    <select id="rembgModel" name="rembg_model" class="select">
                                        <option value="u2net" selected>U2NET</option>
                                        <option value="sam">SAM</option>
                                        <option value="isnet-general-use">ISNET</option>
                                        <option value="birefnet-general">BIREFNET</option>
                                    </select>
                                    <button class="special-button" type="button" id="removeBackground">Remove background
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="row custom-fie-upload">
                            <label for="upload">Carica immagine</label>
                            <input id="upload" type="file" accept="image/*"/>
                        </div>
                    </div>
                    <div id="controls">
                        <h4>Comandi per la generazione</h4>
                        <div class="row text-prompt-row">
                            <label for="textPrompt">Descrivi la modifica:</label>
                            {% if last_prompt %}
                                <textarea
                                        id="textPrompt"
                                >{{ last_prompt }}</textarea>
                            {% else %}
                                <textarea
                                        id="textPrompt"
                                        placeholder="Inserisci il prompt per la modifica..."
                                ></textarea>
                            {% endif %}
                        </div>
                        <div class="row generations-row" style="display:none;">
                            <label for="numGenerations">Numero di varianti:</label>
                            <input
                                    id="numGenerations"
                                    type="number"
                                    min="1"
                                    max="4"
                                    value="1"
                                    aria-label="Numero di generazioni"
                            />
                        </div>
                        <div id="configs-row">
                            <span>
                                <label for="config1">Conf. 1</label>
                                <input type="checkbox" id="config1" name="config1">
                            </span>
                            <span>
                                <label for="config2">Conf. 2</label>
                                <input type="checkbox" id="config2" name="config2">
                            </span>
                            <span>
                                <label for="config3">Conf. 3</label>
                                <input type="checkbox" id="config3" name="config3">
                            </span>
                            <span>
                                <label for="config4">Conf. 4</label>
                                <input type="checkbox" id="config4" name="config4">
                            </span>
                        </div>

                    </div>
                    <button type="button" class="generation-btn-main normal js-startGeneration">
                        Start generation
                    </button>
                </div>

                <!-- COLONNA DESTRA: CANVAS PIÙ GRANDE -->
                <div class="hero-editor-card">
                    <div class="main-div">
                        <div class="canvas-section">
                            <div class="canvas-box">
                                <canvas
                                        id="canvas"
                                        width="256"
                                        height="256">
                                </canvas>
                                <canvas
                                        id="bgCanvas"
                                        width="256"
                                        height="256">
                                </canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- DOWNLOAD ZIP SOTTO I CONTROLLI -->
                <button type="button" class="generation-btn-main small js-startGeneration">
                    Start generation
                </button>

                <!-- QUI MOSTRO ERRORI CLIENT-->
                <div id="formErrors" class="form-errors" aria-live="polite"></div>
                <!-- QUI MOSTRO ERRORI SERVER -->
                {% if errors %}
                    <div class="server-errors">
                        <ul>
                            {% for e in errors %}
                                <li>{{ e }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
                <!-- CAMPI HIDDEN CHE VERRANNO RIEMPITI IN JS -->
                <input type="hidden" name="prompt" id="hiddenPrompt">
                <input type="hidden" name="num_generations" id="hiddenNumGenerations">
                <input type="hidden" name="original_image" id="hiddenOriginalImage">
                <input type="hidden" name="mask_image" id="hiddenMaskImage">
            </form>
        </section>

        <!-- SEZIONE STATO GENERAZIONE -->
        <div id="generation-status" class="status-box" style="display: none;">
            <span id="status-text">In attesa...</span>
        </div>

        <!-- SEZIONE RISULTATI GENERAZIONE -->
        <section id="resultsSection" class="results-section" style="display: none;">
            <h2>Risultati della generazione</h2>
            <p class="results-intro">...</p>

            <!-- toolbar (nuova) -->
            <div class="results-toolbar">
                <div class="results-meta">
                    <strong id="resultsTitle">Varianti generate</strong>
                    <span id="resultsSubtitle">Seleziona una variante o avvia la super-resolution.</span>
                </div>

                <button id="downloadBtn" class="download-btn-main normal" disabled>
                    Download
                </button>
            </div>

            <div id="resultsGrid" class="results-flex"></div>
        </section>
        <!-- SEZIONE INFO SOTTO -->
        <section class="info-section">
            <div class="info-grid">
                <article class="info-card">
                    <h2>Come funziona l'editor</h2>
                    <p>
                        Puoi utilizzare gli strumenti forniti per generare quello che desideri. Crea la maschera adatta
                        alla modifica che vuoi fare, oppure rimuovi lo sfondo per una generazione più precisa.
                    </p>
                </article>

                <article class="info-card">
                    <h2>Sulle configurazioni</h2>
                    <p>
                        Dato che non è stata definita la configurazione standard, te ne proponiamo quattro diverse tra
                        cui scegliere. E' possibile che una configurazione non produca risultati ottimali.
                    </p>
                </article>

                <article class="info-card">
                    <h2>Utilizzo della superrisoluzione</h2>
                    <p>
                        Una volta ottenuti i risultati della generazione puoi decidere di applicare la super-risoluzione
                        per migliorarne la qualità. Le immagini passeranno quindi da una risoluzione 256x256 a
                        1024x1024.
                    </p>
                </article>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="site-footer">
        <div class="footer-inner">
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
            <span class="footer-small">© 2025 Inpainter Mask Editor</span>
        </div>
    </footer>
</div>

<img id="hiddenImg" alt=""/>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script src="{% static 'image_editor/js/editor.js' %}"></script>
</body>
</html>
